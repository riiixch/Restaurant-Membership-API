generator client {
  provider = "prisma-client-js"
  //output   = "../generated/prisma"
}

datasource db {
  provider = "mongodb"
  url      = env("DATABASE_URL")
}

model User {
  id        String    @id @default(auto()) @map("_id") @db.ObjectId
  name      String
  email     String    @unique
  phone     String
  birthday  DateTime?
  cards     Card[]
  points    Int       @default(0)
  tierId    String    @db.ObjectId
  tier      Tier      @relation(fields: [tierId], references: [id])
  createdAt DateTime  @default(now())
}

model Card {
  id          String        @id @default(auto()) @map("_id") @db.ObjectId
  cardId      String        @unique
  userIds     String[]      @db.ObjectId
  users       User[]        @relation(fields: [userIds], references: [id])
  fee         Float         @default(0)
  points      Int           @default(0)
  createdAt   DateTime      @default(now())
  Transaction Transaction[]
}

model Tier {
  id          String   @id @default(auto()) @map("_id") @db.ObjectId
  name        String
  minSpending Float
  benefits    String[]
  users       User[]
}

model Transaction {
  id           String   @id @default(auto()) @map("_id") @db.ObjectId
  cardId       String   @db.ObjectId
  card         Card     @relation(fields: [cardId], references: [id])
  amount       Float
  pointsEarned Int
  createdAt    DateTime @default(now())
}

model Reward {
  id             String  @id @default(auto()) @map("_id") @db.ObjectId
  name           String
  pointsRequired Int
  type           String // "Discount", "Privilege", "Product"
  description    String?
  stock          Int
}

model Setting {
  id             String   @id @default(auto()) @map("_id") @db.ObjectId
  pointsPerSpend Float // เช่น 100 บาท = 1 แต้ม
  cardFee        Float // ค่าสมัครบัตร
  tiers          String[] // ชื่อ Tier เช่น ["Bronze", "Silver"]
}
